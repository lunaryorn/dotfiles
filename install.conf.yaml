# Configuration file for Unix systems, eg, macos and Linux.
#
# Since Windows is so special, it has its own config file in
# windows/install.conf.yaml which does not share anything with this file.

- defaults:
    link:
      force: true
      create: true
      relink: true
- clean:
    # Prune dead symlinks in these directories
    - "~"
    - "~/.local/bin"
    - "~/.config/fish"
    - "~/.config/fish/functions"
    - "~/.config/fish/conf.d"
    - "~/.config/git"
    - "~/.sbt/1.0/"
    - "~/.sbt/1.0/plugins"
    - "~/.config/powershell"
    - "~/.config/nvim"
    - "~/.config/kitty"
    - "~/.ssh/config.d"
    - "~/.ctags.d"
- shell:
    - description: Check whether FileVault is enabled
      command: sh -c 'uname -s | grep -qi darwin && [ $(fdesetup isactive) == true ] || exit 0'
- link:
    # Symlink entire dotfiles folder, for convenience
    ~/.dotfiles: ""

    # Personal binaries
    ~/.local/bin:
      path: "bin/*"
      glob: true

    # Fish shell config files
    ~/.config/fish/config.fish: fish/config.fish
    ~/.config/fish/functions:
      path: fish/functions/*.fish
      glob: true
    ~/.config/fish/completions:
      path: fish/completions/*.fish
      glob: true
    # Special Fish functions for uberspace
    ~/.config/fish/functions/prompt_hostname.fish:
      path: uberspace/fish/functions/prompt_hostname.fish
      glob: true
      if: "hostname | grep -qi uberspace.de"

    # Powershell Core config files
    ~/.config/powershell/profile.ps1: powershell/profile.ps1
    ~/.config/powershell/Microsoft.Powershell_profile.ps1: powershell/Microsoft.PowerShell_profile.ps1
    ~/.config/powershell/types.ps1xml: powershell/types.ps1xml

    # Git config files
    ~/.config/git/config: git/config
    ~/.config/git/ignore: git/ignore
    ~/.config/git/attributes: git/attributes
    ~/.config/git/config.linux:
      path: git/config.linux
      if: "uname -s | grep -qi linux"
    ~/.config/git/config.macos:
      path: git/config.macos
      if: "uname -s | grep -qi darwin"

    # Scala configuration
    ~/.ammonite/predef.sc: scala/ammonite-predef.sc
    ~/.sbt/1.0/settings.sbt: scala/settings.sbt
    ~/.sbt/1.0/plugins/plugins.sbt: scala/plugins.sbt
    ~/.sbt/1.0/plugins/project/sbt-updates.sbt: scala/sbt-updates.sbt
    # Misc languages
    ~/.npmrc: javascript/npmrc
    ~/.gemrc: misc/gemrc

    # Misc unix tools
    ~/.config/latexmk/latexmkrc: misc/latexmkrc
    ~/.gnupg/gpg.conf: misc/gpg.conf
    ~/.config/bat/config: misc/bat
    # VIM and related tooling
    ~/.config/nvim/init.vim: nvim/init.vim
    ~/.config/nvim/ginit.vim: nvim/ginit.vim
    ~/.local/share/nvim/site/pack/dotfiles: nvim/pack/dotfiles
    ~/.ideavimrc: misc/ideavimrc
    ~/.ctags.d:
      path: misc/ctags.d/*.ctags
      glob: true
    # tmux: Main config to dispatch, and then version-specific configurations
    ~/.tmux.conf: tmux/tmux.conf
    ~/.tmux.2.conf: tmux/tmux.2.conf
    ~/.tmux.1.conf: tmux/tmux.1.conf
    # SSH
    ~/.ssh/config: ssh/config
    ~/.ssh/config.d/:
      path: ssh/config.d/*
      glob: true
    ~/.ssh/config.d/00-macos:
      path: ssh/00-macos
      if: "uname -s | grep -qi darwin"
    # Kitty terminal emulator config
    ~/.config/kitty/:
      path: kitty/*
      glob: true

    # Linux configuration
    ~/.xprofile: linux/xprofile
    ~/.config/rofi/config.rasi:
      path: linux/rofi.rasi
      if: "type -p rofi > /dev/null"
    # Pacman configuration if pacman is installed
    ~/.config/pacman/makepkg.conf:
      path: linux/pacman/makepkg.conf
      if: "test -f /etc/pacman.conf"
    ~/.config/fontconfig/conf.d:
      path: linux/fontconfig/*.conf
      glob: true
      if: "uname -s | grep -qi linux"
    # i3 window manager and tooling
    ~/.config/i3/config:
      path: linux/i3/config
      if: "type -p i3 > /dev/null"
    ~/.config/i3blocks/config:
      path: linux/i3/i3blocks.conf
      if: "type -p i3blocks > /dev/null"
    ~/.local/bin/random-wallpaper:
      path: linux/bin/random-wallpaper.py
      if: "uname -s | grep -qi linux"

    # macOS configuration
    ~/.gnupg/gpg-agent.conf:
      path: macos/gpg-agent.conf
      if: "uname -s | grep -qi darwin"
    # DevonTHINK feed stylesheet for Markdown files
    "~/Library/Application Support/DEVONthink Pro 2/StyleSheets/Vollkorn.css":
      path: macos/devonthink-feed.css
      if: "uname -s | grep -qi darwin"

    # Joplin stylesheet
    ~/.config/joplin-desktop/userstyle.css: joplin/userstyle.css
- shell:
    - description: Set yarn prefix to ~/.local
      command: sh -c 'command -v yarn && yarn config set prefix ~/.local || exit 0'
    - description: "MacOS: Set defaults"
      command: scripts/macos_defaults.py
      stdout: true
      stderr: true
    - description: "MacOS: Install iterm2 utilities"
      command: scripts/macos_iterm2_tools.py
      stdout: true
      stderr: true

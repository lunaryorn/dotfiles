# Configuration file for Unix systems
#
# Since Windows is so special, it has its own config file in
# windows/install.conf.yaml which does not share anything with this file.

- defaults:
    link:
      force: true
      create: true
      relink: true
- clean:
    # Prune dead symlinks in these directories
    - "~"
    - "~/.local/bin"
    - "~/.config/fish"
    - "~/.config/fish/functions"
    - "~/.config/fish/conf.d"
    - "~/.config/git"
    - "~/.sbt/1.0/"
    - "~/.sbt/1.0/plugins"
    - "~/.ssh/config.d"
- link:
    # Symlink entire dotfiles folder, for convenience
    ~/.dotfiles: ""

    # Personal binaries
    ~/.local/bin:
      path: "bin/*"
      glob: true

    # Fish shell config files
    ~/.config/fish/config.fish: fish/config.fish
    ~/.config/fish/functions/fisher.fish: submodules/fisher/fisher.fish
    ~/.config/fish/fishfile: fish/fishfile
    ~/.config/fish/functions:
      path: fish/functions/*.fish
      glob: true

    # Git config files and tools
    ~/.config/git/config: git/config
    ~/.config/git/ignore: git/ignore
    ~/.config/git/attributes: git/attributes
    ~/.config/git/config.linux:
      path: git/config.linux
      if: "uname -s | grep -qi linux"

    # Scala configuration
    ~/.ammonite/predef.sc: scala/ammonite-predef.sc
    ~/.sbt/1.0/settings.sbt: scala/settings.sbt
    ~/.sbt/1.0/plugins/plugins.sbt: scala/plugins.sbt
    ~/.sbt/1.0/plugins/sbt-updates.sbt: scala/sbt-updates.sbt
    ~/.sbt/1.0/plugins/project/sbt-updates.sbt: scala/sbt-updates.sbt
    # Misc languages
    ~/.npmrc: javascript/npmrc
    ~/.gemrc: misc/gemrc

    # Misc unix tools
    ~/.config/latexmk/latexmkrc: misc/latexmkrc
    ~/.config/bat/config: misc/bat
    # SSH
    ~/.ssh/config: ssh/config
    ~/.ssh/config.d/:
      path: ssh/config.d/*
      glob: true

    # Linux configuration (basic)
    ~/.local/bin/reset-thunderbolt.bash:
      path: linux/reset-thunderbolt.bash
      if: "uname -s | grep -qi linux"
    # Linux fontconfig, for emojis
    ~/.config/fontconfig/conf.d/69-emoji.conf:
      path: submodules/fontconfig-emoji/69-emoji.conf
      if: "uname -s | grep -qi linux"
    ~/.config/fontconfig/conf.d/70-no-dejavu.conf:
      path: submodules/fontconfig-emoji/70-no-dejavu.conf
      if: "uname -s | grep -qi linux"
    ~/.config/fontconfig/conf.d/70-no-mozilla-emoji.conf:
      path: submodules/fontconfig-emoji/70-no-mozilla-emoji.conf
      if: "uname -s | grep -qi linux"
    # Linux configuration (Arch)
    ~/.config/pacman/makepkg.conf:
      path: linux/arch/makepkg.conf
      if: "test -f /etc/pacman.conf"
    ~/.local/bin/notify-checkupdates:
      path: linux/arch/notify-checkupdates
      if: "test -f /etc/pacman.conf"
    ~/.local/share/systemd/user/notify-checkupdates.service:
      path: linux/arch/notify-checkupdates.service
      if: "test -f /etc/pacman.conf"
    ~/.local/share/systemd/user/notify-checkupdates.timer:
      path: linux/arch/notify-checkupdates.timer
      if: "test -f /etc/pacman.conf"

    # Linux configuration (desktops)
    ~/.local/bin/random-wallpaper:
      path: linux/bin/random-wallpaper.py
      if: "uname -s | grep -qi linux"
    ~/.local/bin/ui-theme:
      path: linux/bin/ui-theme.bash
      if: "uname -s | grep -qi linux"

    # Gnome
    ~/.local/share/gnome-shell/extensions/home@swsnr.de:
      path: linux/gnome/extensions/home@swsnr.de/*
      glob: true
      if: "uname -s | grep -qi linux"

    # X11 settings: xprofile for i3 environment, Xresources for some X11 settings
    # and dynamic i3 themeing, and xinitrc to start an X11 instance with i3wm
    # from xrdp.
    ~/.xprofile:
      path: linux/i3/xprofile.sh
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.Xresources:
      path: linux/i3/Xresources
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.xinitrc:
      path: linux/i3/xinitrc
      if: "i3 --version | grep -qi 'i3 version'"
    # i3 with custom scripts, and i3blocks for the status bar
    ~/.config/i3/config:
      path: linux/i3/config
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.config/i3/themes:
      path: linux/i3/themes/*
      glob: true
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.local/bin/i3-rofi:
      path: linux/i3/bin/i3-rofi.bash
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.local/bin/i3-rename-workspace:
      path: linux/i3/bin/i3-rename-workspace
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.local/bin/lock-screen:
      path: linux/i3/bin/lock-screen.bash
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.config/i3blocks/config:
      path: linux/i3/i3blocks.conf
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.config/i3blocks/blocklets:
      path: linux/i3/blocklets/*
      glob: true
      if: "i3 --version | grep -qi 'i3 version'"
    # Notification daemon
    ~/.config/dunst/dunstrc:
      path: linux/i3/dunstrc
      if: "i3 --version | grep -qi 'i3 version'"
    # Compositor
    ~/.config/picom/picom:
      path: linux/i3/picom.conf
      if: "picom --version | grep -qi v"
    # Extra modes for Rofi launcher
    ~/.local/bin/rofi-idea-projects:
      path: linux/i3/bin/rofi-idea-projects
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.local/bin/rofi-code-projects:
      path: linux/i3/bin/rofi-code-projects
      if: "i3 --version | grep -qi 'i3 version'"
    ~/.local/bin/rofi-yes-no:
      path: linux/i3/bin/rofi-yes-no.bash
      if: "i3 --version | grep -qi 'i3 version'"

    # Sway
    ~/.config/sway/config:
      path: linux/sway/config
      if: "sway --version | grep -qi 'sway version'"
    ~/.config/sway/conf.d/:
      path: linux/sway/conf.d/*
      glob: true
      if: "sway --version | grep -qi 'sway version'"
    ~/.config/sway/themes/:
      path: linux/sway/themes/*
      glob: true
      if: "sway --version | grep -qi 'sway version'"

    # ZIM style configuration
    ~/.config/zim/style.conf: misc/zim-style.conf
- shell:
    - description: Create SSH connetion sockets
      command: sh -c 'mkdir -p ~/.ssh/sockets'
    - description: Set yarn prefix to ~/.local
      command: sh -c 'command -v yarn && yarn config set prefix ~/.local || exit 0'
    - description: Code OSS settings
      command: misc/code-settings.py
      stdout: true
    - description: Gnome settings
      command: bash linux/gnome/settings.bash
      stdout: true
